var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,l=(a,r,t)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,o=(e,o)=>{for(var n in o||(o={}))a.call(o,n)&&l(e,n,o[n]);if(r)for(var n of r(o))t.call(o,n)&&l(e,n,o[n]);return e};import{h as n}from"./index.8f230dce.js";import{Z as d,a3 as i,r as c,t as s,_ as u,b as p,e as g,f as m,g as y,a9 as f,h,k as v,u as b,o as C,l as k,p as _,d as F,a6 as I,a7 as w,a8 as S,w as x}from"./vendor.0469baee.js";const P={name:"DialogAddCategory",props:{type:String,reload:Function},setup(e){const a=d(null),r=i(),t=c({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"排序值不能为空",trigger:["change"]}]},id:""});return o(o({},s(t)),{open:e=>{if(t.visible=!0,e)t.id=e,(e=>{p.get(`/categories/${e}`).then((e=>{t.ruleForm={name:e.categoryName,rank:e.categoryRank},t.parentId=e.parentId,t.categoryLevel=e.categoryLevel}))})(e);else{const{level:e=1,parent_id:a=0}=r.query;t.ruleForm={name:"",rank:""},t.parentId=a,t.categoryLevel=e}},close:()=>{t.visible=!1},formRef:a,submitForm:()=>{a.value.validate((a=>{if(a){if(n(t.ruleForm.name))return void u.error("不要输入表情包，再输入就打死你个龟孙儿~");if(t.ruleForm.name.length>16)return void u.error("名称不能超过16个字符");if(t.ruleForm.rank>200)return void u.error("排序不能超过200");"add"==e.type?p.post("/categories",{categoryLevel:t.categoryLevel,parentId:t.parentId,categoryName:t.ruleForm.name,categoryRank:t.ruleForm.rank}).then((()=>{u.success("添加成功"),t.visible=!1,e.reload&&e.reload()})):p.put("/categories",{categoryId:t.id,categoryLevel:t.categoryLevel,parentId:t.parentId,categoryName:t.ruleForm.name,categoryRank:t.ruleForm.rank}).then((()=>{u.success("修改成功"),t.visible=!1,e.reload&&e.reload()}))}}))}})}},D={class:"dialog-footer"},L=v("取 消"),V=v("确 定");P.render=function(e,a,r,t,l,o){const n=g("el-input"),d=g("el-form-item"),i=g("el-form"),c=g("el-button"),s=g("el-dialog");return m(),y(s,{title:"add"==r.type?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":a[4]||(a[4]=a=>e.visible=a),width:"400px"},{footer:f((()=>[h("span",D,[h(c,{onClick:a[3]||(a[3]=a=>e.visible=!1)},{default:f((()=>[L])),_:1}),h(c,{type:"primary",onClick:t.submitForm},{default:f((()=>[V])),_:1},8,["onClick"])])])),default:f((()=>[h(i,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"good-form"},{default:f((()=>[h(d,{label:"分类名称",prop:"name"},{default:f((()=>[h(n,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.ruleForm.name=a)},null,8,["modelValue"])])),_:1}),h(d,{label:"排序值",prop:"rank"},{default:f((()=>[h(n,{type:"number",max:"200",modelValue:e.ruleForm.rank,"onUpdate:modelValue":a[2]||(a[2]=a=>e.ruleForm.rank=a)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])};const z={name:"Category",components:{DialogAddCategory:P},setup(){const e=d(null),a=d(null),r=b(),t=i(),l=c({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});C((()=>{g()})),k((()=>{n()}));const n=r.afterEach((e=>{["category","level2","level3"].includes(e.name)&&g()})),g=()=>{const{level:e=1,parent_id:a=0}=t.query;l.loading=!0,p.get("/categories",{params:{pageNumber:l.currentPage,pageSize:l.pageSize,categoryLevel:e,parentId:a}}).then((r=>{l.tableData=r.list,l.total=r.totalCount,l.currentPage=r.currPage,l.loading=!1,l.level=e,l.parentId=a}))};return o(o({},s(l)),{multipleTable:e,handleSelectionChange:e=>{l.multipleSelection=e},addGood:a,handleAdd:()=>{l.type="add",a.value.open()},handleEdit:e=>{l.type="edit",a.value.open(e)},handleDelete:()=>{l.multipleSelection.length?p.delete("/categories",{data:{ids:l.multipleSelection.map((e=>e.categoryId))}}).then((()=>{u.success("删除成功"),g()})):u.error("请选择项")},handleDeleteOne:e=>{p.delete("/categories",{data:{ids:[e]}}).then((()=>{u.success("删除成功"),g()}))},getCategory:g,changePage:e=>{l.currentPage=e,g()},handleNext:e=>{const a=e.categoryLevel+1;4!=a?r.push({name:`level${a}`,query:{level:a,parent_id:e.categoryId}}):u.error("没有下一级")}})}},O=x();_("data-v-4d5aa038");const N={class:"header"},j=v("增加"),R=v("批量删除"),q=h("a",{style:{cursor:"pointer"}},"删除",-1);F();const A=O(((e,a,r,t,l,o)=>{const n=g("el-button"),d=g("el-popconfirm"),i=g("el-table-column"),c=g("el-table"),s=g("el-pagination"),u=g("el-card"),p=g("DialogAddCategory"),f=I("loading");return m(),y(S,null,[h(u,{class:"category-container"},{header:O((()=>[h("div",N,[h(n,{type:"primary",size:"small",icon:"el-icon-plus",onClick:t.handleAdd},{default:O((()=>[j])),_:1},8,["onClick"]),h(d,{title:"确定删除吗？",onConfirm:t.handleDelete},{reference:O((()=>[h(n,{type:"danger",size:"small",icon:"el-icon-delete"},{default:O((()=>[R])),_:1})])),_:1},8,["onConfirm"])])])),default:O((()=>[w(h(c,{ref:"multipleTable",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:t.handleSelectionChange},{default:O((()=>[h(i,{type:"selection",width:"55"}),h(i,{prop:"categoryName",label:"分类名称"}),h(i,{prop:"categoryRank",label:"排序值",width:"120"}),h(i,{prop:"createTime",label:"添加时间",width:"200"}),h(i,{label:"操作",width:"220"},{default:O((e=>[h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>t.handleEdit(e.row.categoryId)},"修改",8,["onClick"]),h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>t.handleNext(e.row)},"下级分类",8,["onClick"]),h(d,{title:"确定删除吗？",onConfirm:a=>t.handleDeleteOne(e.row.categoryId)},{reference:O((()=>[q])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data","onSelectionChange"]),[[f,e.loading]]),h(s,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:t.changePage},null,8,["total","page-size","current-page","onCurrentChange"])])),_:1}),h(p,{ref:"addGood",reload:t.getCategory,type:e.type,level:e.level,parent_id:e.parent_id},null,8,["reload","type","level","parent_id"])],64)}));z.render=A,z.__scopeId="data-v-4d5aa038";export default z;
